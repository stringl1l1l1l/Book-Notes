# Rustç¨‹åºè®¾è®¡è¯­è¨€
## cargoåŸºç¡€
- **æ–°å»ºcargoé¡¹ç›®**
```
cargo new <project name>  
```
è¯¥å‘½ä»¤ç”Ÿæˆçš„é¡¹ç›®ç›®å½•ç»“æ„ï¼š  
src æºä»£ç ç›®å½•  
Cargo.toml è®°å½•é¡¹ç›®åŒ…ä¾èµ–  
.gitignore  

- **æ„å»ºcargoé¡¹ç›®**
```
cargo build             // debugæ¨¡å¼
cargo build âˆ’âˆ’release   // releaseæ¨¡å¼ï¼Œé€Ÿåº¦æ›´å¿«
```
è¯¥å‘½ä»¤é¢å¤–ç”Ÿæˆçš„æ–‡ä»¶å’Œç›®å½•ï¼š  
target  ç›®æ ‡æ–‡ä»¶ç›®å½•  
Cargo.lock è®°å½•ä¾èµ–åŒ…ç‰ˆæœ¬ï¼Œç¡®ä¿å¯é‡ç°æ„å»º  

- **æ„å»ºå¹¶è¿è¡Œcargoé¡¹ç›®**
```
cargo run
```

- **æ£€æŸ¥cargoé¡¹ç›®æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯ï¼Œä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶**
```
cargo check
```

## ruståŸºæœ¬è¯­æ³•  
> æ ‡æ³¨ğŸ§ä»£è¡¨ç›¸æ¯”äºC/C++ï¼Œrustçš„æ¯”è¾ƒæ˜æ˜¾çš„ä¸åŒä¹‹å¤„ã€‚  

### å˜é‡å’Œå¯å˜æ€§
#### å˜é‡
ğŸ§rustä¸­å˜é‡ä½¿ç”¨*let*å…³é”®å­—åˆ›å»ºï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ã€‚è‹¥å¸Œæœ›åˆ›å»ºå¯å˜å˜é‡ï¼Œéœ€æ·»åŠ *mut*å…³é”®å­—ã€‚
```rust
let mut x = 5;
println!("The value of x is: {x}");
x = 6;
println!("The value of x is: {x}");
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
The value of x is: 5
The value of x is: 6
```

#### å¸¸é‡
rustä¸­å¸¸é‡ä½¿ç”¨*const*å…³é”®å­—åˆ›å»ºï¼Œå¿…é¡»æ³¨æ˜å€¼çš„ç±»å‹ï¼Œå¿…é¡»èµ‹å€¼ï¼Œä¸€å®šæ˜¯ä¸å¯å˜çš„ï¼Œæ— æ³•æ·»åŠ *mut*å…³é”®å­—ã€‚  
```rust
const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
```
#### éšè— shadowingğŸ§
åœ¨rustä¸­ï¼Œé‡æ–°å¯¹åŒåå˜é‡è¿›è¡Œé‡å¤å£°æ˜ï¼Œæ–°å£°æ˜çš„å˜é‡ä¼šè¦†ç›–æ—§å˜é‡ï¼Œç§°ä¸ºéšè—ï¼ˆshadowingï¼‰ã€‚å¯ä»¥å¯¹åŒä¸€ä¸ªå˜é‡éšè—å¤šæ¬¡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸åŒç±»å‹è¿›è¡Œéšè—ã€‚éœ€è¦æ³¨æ„éšè—æ˜¯æœ‰ä½œç”¨åŸŸçš„ã€‚    
```rust
fn main() {
    let x = 5;
    let x = x + 1;
    {
        let x = x * 2;
        println!("The value of x in the inner scope is: {x}");
    }
    println!("The value of x is: {x}");
}
________________________________________________________________________
The value of x in the inner scope is: 12
The value of x is: 6
```
éšè—å’Œmutçš„åŒºåˆ«ï¼š  
```rust
éšè—ï¼šå¯é€šè¿‡ç¼–è¯‘
let spaces = "   ";           // stringç±»å‹
let spaces = spaces.len();    // usizeç±»å‹

mutï¼šç¼–è¯‘é”™è¯¯
let mut spaces = "   ";
let spaces = spaces.len();
```

### æ•°æ®ç±»å‹  
rustçš„æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œå¤åˆï¼ˆcompoundï¼‰ã€‚  
#### æ ‡é‡ç±»å‹  
å››ç§åŸºæœ¬æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹ã€‚
- **æ•´å‹**  
i32æ˜¯æ•´å‹æ•°å­—é»˜è®¤ç±»å‹  
<table>
    <tr>
        <td>é•¿åº¦</td> <td>æœ‰ç¬¦å·</td> <td>æ— ç¬¦å·</td>
    </tr>
     <tr>
        <td>8-bit</td> <td>i8</td> <td>u8</td>
    </tr>
     <tr>
        <td>16-bit</td> <td>i16</td> <td>u16</td>
    </tr>
     <tr>
        <td>32-bit</td> <td>i32</td> <td>u32</td>
    </tr>
     <tr>
        <td>64-bit</td> <td>i64</td> <td>u64</td>
    </tr>
    <tr>
        <td>128-bit</td> <td>i128</td> <td>u128</td>
    </tr>
    <tr>
        <td>arch</td> <td>isize</td> <td>usize</td>
    </tr>
</table>  

<table>
<tr>
     <td>Decimal (åè¿›åˆ¶)</td>    <td>98_222</td>
</tr>
<tr>
 <td>Hex (åå…­è¿›åˆ¶)</td>    <td>0xff</td>
</tr>
<tr>
 <td>Octal (å…«è¿›åˆ¶)</td>	    <td>0o77</td>
</tr>
<tr>
 <td>Binary (äºŒè¿›åˆ¶)</td>    <td>0b1111_0000</td>
</tr>
<tr>
 <td>Byte (å•å­—èŠ‚å­—ç¬¦)(ä»…é™äºu8)</td>	 <td>b'A'</td>
</tr>
</table>
> æ•°å­—å­—é¢é‡å¯ä»¥æ·»åŠ ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åˆ†å‰²æ–¹ä¾¿é˜…è¯»ï¼Œå¦‚1000_0000ç­‰åŒäº10000000  

- **æµ®ç‚¹å‹**  
IEEE-754æ ‡å‡†ï¼Œf32å’Œf64ï¼Œé»˜è®¤ä¸ºf64ã€‚

- **å¸ƒå°”å‹**  
boolç±»å‹å¤§å°ä¸º1ä¸ªå­—èŠ‚ã€‚

- **å­—ç¬¦å‹**  
ğŸ§charç±»å‹å¤§å°ä¸º4ä¸ªå­—èŠ‚ï¼Œä»£è¡¨ä¸€ä¸ªUnicodeæ ‡é‡å€¼ã€‚
```rust
let c = 'z';
let z: char = 'â„¤'; // with explicit type annotation
let heart_eyed_cat = 'ğŸ˜»';
```
#### å¤åˆç±»å‹  
å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚rustæœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰ã€‚

- **å…ƒç»„ç±»å‹**  
å…ƒç»„æ˜¯ä¸€ä¸ªå°†å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ã€‚å…ƒç»„é•¿åº¦å›ºå®šï¼Œä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°ã€‚
```rust
let tup: (i32, f64, u8) = (500, 6.4, 1);
```
ä¸ºäº†ä»å…ƒç»„ä¸­è·å–å•ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰æ¥è§£æ„ï¼ˆdestructureï¼‰å…ƒç»„å€¼ï¼š
```rust
let tup = (500, 6.4, 1);
let (x, y, z) = tup;
```
æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç‚¹å·ï¼ˆ.ï¼‰åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬ã€‚ä¾‹å¦‚ï¼š
```rust
let x: (i32, f64, u8) = (500, 6.4, 1);
let five_hundred = x.0;
let six_point_four = x.1;
let one = x.2;
```
ğŸ§ä¸å¸¦ä»»ä½•å€¼çš„å…ƒç»„æœ‰ä¸ªç‰¹æ®Šçš„åç§°ï¼Œå«åš**å•å…ƒï¼ˆunitï¼‰å…ƒç»„**ã€‚è¿™ç§å€¼ä»¥åŠå¯¹åº”çš„ç±»å‹éƒ½å†™ä½œ `()`ï¼Œè¡¨ç¤ºç©ºå€¼æˆ–ç©ºçš„è¿”å›ç±»å‹ã€‚**å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œåˆ™ä¼šéšå¼è¿”å›å•å…ƒå€¼**ã€‚

- **æ•°ç»„ç±»å‹**  
ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚Rustä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚
```rust
let a = [1, 2, 3, 4, 5];
```
å¯ä»¥åƒè¿™æ ·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼šåœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡ï¼š
```rust
let a: [i32; 5] = [1, 2, 3, 4, 5];
```
å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼åŠ åˆ†å·å†åŠ å…ƒç´ ä¸ªæ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªæ¯ä¸ªå…ƒç´ éƒ½ä¸ºç›¸åŒå€¼çš„æ•°ç»„ï¼š
```rust
let a = [3; 5]; // [3, 3, 3, 3, 3]
```
è®¿é—®æ•°ç»„å…ƒç´ ï¼š
```rust
let a = [1, 2, 3, 4, 5];

let first = a[0];
let second = a[1];
```
ğŸ§åœ¨æ•°ç»„ä¸­è¶Šç•Œè®¿é—®å…ƒç´ ï¼Œä¼šå¯¼è‡´ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ï¼Œç¨‹åºç«‹å³åœ¨é”™è¯¯å¤„é€€å‡ºã€‚åœ¨Rustä¸­ï¼Œè¿™ç§æƒ…å†µç§°ä¸º*panic*ï¼ŒæŒ‡ç¨‹åºå› ä¸ºé”™è¯¯è€Œé€€å‡ºçš„æƒ…å†µã€‚  
### å‡½æ•°

åœ¨ Rust ä¸­é€šè¿‡è¾“å…¥ `fn` åé¢è·Ÿç€å‡½æ•°åå’Œä¸€å¯¹åœ†æ‹¬å·æ¥å®šä¹‰å‡½æ•°ã€‚  
Rust ä¸å…³å¿ƒå‡½æ•°å®šä¹‰æ‰€åœ¨çš„ä½ç½®ï¼Œåªè¦å‡½æ•°è¢«è°ƒç”¨æ—¶å‡ºç°åœ¨è°ƒç”¨ä¹‹å¤„å¯è§çš„ä½œç”¨åŸŸå†…å°±è¡Œã€‚  

#### å‚æ•°  
ğŸ§åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ**å¿…é¡»** å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€‚è¿™æ˜¯ Rust è®¾è®¡ä¸­ä¸€ä¸ªç»è¿‡æ…é‡è€ƒè™‘çš„å†³å®šï¼šè¦æ±‚åœ¨å‡½æ•°å®šä¹‰ä¸­æä¾›ç±»å‹æ³¨è§£ã€‚  

```rust
fn main() {
    print_labeled_measurement(5, 'h');
}

fn print_labeled_measurement(value: i32, unit_label: char) {
    println!("The measurement is: {value}{unit_label}");
}
```

#### è¯­å¥å’Œè¡¨è¾¾å¼
ğŸ§Rust æ˜¯ä¸€é—¨åŸºäºè¡¨è¾¾å¼ï¼ˆexpression-basedï¼‰çš„è¯­è¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦ç†è§£çš„ä¸åŒäºå…¶ä»–è¯­è¨€çš„é‡è¦åŒºåˆ«ã€‚   
**è¯­å¥**ï¼ˆ*Statements*ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ã€‚ **è¡¨è¾¾å¼**ï¼ˆ*Expressions*ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼ã€‚  

```rust
fn main() {
    let x = (let y = 6);
}
_________________________________
compile error!
```

ğŸ§`let y = 6` è¯­å¥å¹¶ä¸è¿”å›å€¼ï¼Œæ‰€ä»¥æ²¡æœ‰å¯ä»¥ç»‘å®šåˆ° `x` ä¸Šçš„å€¼ã€‚è¿™ä¸å…¶ä»–è¯­è¨€ä¸åŒï¼Œä¾‹å¦‚ C å’Œ Rubyï¼Œå®ƒä»¬çš„èµ‹å€¼è¯­å¥ä¼šè¿”å›æ‰€èµ‹çš„å€¼ã€‚åœ¨è¿™äº›è¯­è¨€ä¸­ï¼Œå¯ä»¥è¿™ä¹ˆå†™ `x = y = 6`ï¼Œè¿™æ · `x` å’Œ `y` çš„å€¼éƒ½æ˜¯ `6`ï¼›Rust ä¸­ä¸èƒ½è¿™æ ·å†™ã€‚  
```rust
fn main() {
    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {y}");
}
```

>ğŸ§æ³¨æ„ `x+1` è¿™ä¸€è¡Œåœ¨ç»“å°¾æ²¡æœ‰åˆ†å·ï¼Œä¸è§è¿‡çš„å¤§éƒ¨åˆ†ä»£ç è¡Œä¸åŒã€‚**è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚**

#### å…·æœ‰è¿”å›å€¼çš„å‡½æ•°  
  æˆ‘ä»¬å¹¶ä¸å¯¹å‡½æ•°è¿”å›å€¼å‘½åï¼Œä½†è¦åœ¨ç®­å¤´ï¼ˆ`->`ï¼‰åå£°æ˜å®ƒçš„ç±»å‹ã€‚åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ `return` å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†å¤§éƒ¨åˆ†å‡½æ•°éšå¼çš„è¿”å›æœ€åçš„è¡¨è¾¾å¼ã€‚  

  ```rust
  fn main() {
      let x = plus_one(5);
      println!("The value of x is: {x}");
  }
  
  fn plus_one(x: i32) -> i32 {
      x + 1
  }
  ```

### æ§åˆ¶æµ

#### ifè¡¨è¾¾å¼

ğŸ§`if`åçš„æ¡ä»¶ **å¿…é¡»** æ˜¯ `bool` å€¼ã€‚å¦‚æœæ¡ä»¶ä¸æ˜¯ `bool` å€¼ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚

- **åœ¨letè¯­å¥ä¸­ä½¿ç”¨if**  
  å› ä¸º `if` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `let` è¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒã€‚

  ```rust
  fn main() {
      let condition = true;
      let number = if condition { 5 } else { 6 };
  
      println!("The value of number is: {number}");
  }
  ```
  è®°ä½ï¼Œä»£ç å—çš„å€¼æ˜¯å…¶æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè€Œæ•°å­—æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•´ä¸ª `if` è¡¨è¾¾å¼çš„å€¼å–å†³äºå“ªä¸ªä»£ç å—è¢«æ‰§è¡Œã€‚**è¿™æ„å‘³ç€ `if` çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹ã€‚**å¦‚æœå®ƒä»¬çš„ç±»å‹ä¸åŒ¹é…ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œåˆ™ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼š  

    ```rust
    fn main() {
        let condition = true;
    
        let number = if condition { 5 } else { "six" };
    
        println!("The value of number is: {number}");
    }
    ```

#### å¾ªç¯  

- **loopå¾ªç¯ï¼ˆæ— é™å¾ªç¯ï¼‰**  

  ```rust
  fn main() {
      loop {
          println!("again!");
      }
  }
  ```
  å¦‚æœå°†è¿”å›å€¼åŠ å…¥ä½ ç”¨æ¥åœæ­¢å¾ªç¯çš„ `break` è¡¨è¾¾å¼ï¼Œå®ƒä¼šè¢«åœæ­¢çš„å¾ªç¯è¿”å›ï¼š

  ```rust
  fn main() {
      let mut counter = 0;
  
      let result = loop {
          counter += 1;
  
          if counter == 10 {
              break counter * 2;
          }
      };
  
      println!("The result is {result}");
  }
  ___________________________________________
  The result is 20
  ```

- **ğŸ§å¾ªç¯æ ‡ç­¾**  
  å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œ`break` å’Œ `continue` åº”ç”¨äºæ­¤æ—¶æœ€å†…å±‚çš„å¾ªç¯ã€‚ä½ å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªå¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ª **å¾ªç¯æ ‡ç­¾**ï¼ˆ*loop label*ï¼‰ï¼Œç„¶åå°†æ ‡ç­¾ä¸ `break` æˆ– `continue` ä¸€èµ·ä½¿ç”¨ï¼Œä½¿è¿™äº›å…³é”®å­—åº”ç”¨äºå·²æ ‡è®°çš„å¾ªç¯è€Œä¸æ˜¯æœ€å†…å±‚çš„å¾ªç¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªåµŒå¥—å¾ªç¯çš„ç¤ºä¾‹ï¼š

  ```rust
  fn main() {
      let mut count = 0;
      'counting_up: loop {
          println!("count = {count}");
          let mut remaining = 10;
  
          loop {
              println!("remaining = {remaining}");
              if remaining == 9 {
                  break;
              }
              if count == 2 {
                  break 'counting_up;
              }
              remaining -= 1;
          }
  
          count += 1;
      }
      println!("End count = {count}");
  }
  ____________________________________________________________
  count = 0
  remaining = 10
  remaining = 9
  count = 1
  remaining = 10
  remaining = 9
  count = 2
  remaining = 10
  End count = 2
  ```
  
- **whileå¾ªç¯**  

  ```rust
  fn main() {
      let mut number = 3;
  
      while number != 0 {
          println!("{number}!");
  
          number -= 1;
      }
  
      println!("LIFTOFF!!!");
  }
  __________________________________
  3!
  2!
  1!
  LIFTOFF!!!
  ```
- **forå¾ªç¯**  

  ```rust
  fn main() {
      let a = [10, 20, 30, 40, 50];
  
      for element in a {
          println!("the value is: {element}");
      }
  }
  __________________________________________________
  the value is: 10
  the value is: 20
  the value is: 30
  the value is: 40
  the value is: 50
  ```
  é€šè¿‡ä½¿ç”¨ rangeï¼Œå®ƒæ˜¯æ ‡å‡†åº“æä¾›çš„ç±»å‹ï¼Œç”¨æ¥ç”Ÿæˆä»ä¸€ä¸ªæ•°å­—å¼€å§‹åˆ°å¦ä¸€ä¸ªæ•°å­—ä¹‹å‰ç»“æŸçš„æ‰€æœ‰æ•°å­—çš„åºåˆ—ï¼Œå¹¶ä½¿ç”¨`rev`åè½¬ rangeï¼š
  ```rust
  fn main() {
      for number in (1..4).rev() {
          println!("{number}!");
      }
      println!("LIFTOFF!!!");
  }
  _______________________________
  3!
  2!
  1!
  LIFTOFF!!!
  ```
  
- ***Rangeç±»å‹***

1. **Rangeï¼ˆ..ï¼‰å·¦é—­å³å¼€**

   ```rust
   fn main() {
       for i in 1..5 {
           println!("{}", i); // è¾“å‡º1, 2, 3, 4
       }
   }
   ```

2. **RangeInclusiveï¼ˆ..=ï¼‰å·¦é—­å³é—­**

   ```rust
   fn main() {
       for i in 1..=5 {
           println!("{}", i); // è¾“å‡º1, 2, 3, 4, 5
       }
   }
   ```

3. **RangeToï¼ˆ..endï¼‰0åˆ°æŸä¸ªç»“æŸå€¼ï¼ˆä¸åŒ…æ‹¬ï¼‰**

   ```rust
   fn main() {
       for i in ..5 {
           println!("{}", i); // è¾“å‡º0, 1, 2, 3, 4
       }
   }
   ```

4. **RangeToInclusiveï¼ˆ..=endï¼‰ï¼‰0åˆ°æŸä¸ªç»“æŸå€¼ï¼ˆåŒ…æ‹¬ï¼‰**

   ```rust
   fn main() {
       for i in ..=5 {
           println!("{}", i); // è¾“å‡º0, 1, 2, 3, 4, 5
       }
   }
   ```
### æ‰€æœ‰æƒğŸ§

æ‰€æœ‰æƒï¼ˆ*ownership*ï¼‰æ˜¯ Rust æœ€ä¸ºä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼Œå¯¹è¯­è¨€çš„å…¶ä»–éƒ¨åˆ†æœ‰ç€æ·±åˆ»å«ä¹‰ã€‚å®ƒè®© Rust æ— éœ€åƒåœ¾å›æ”¶å³å¯ä¿éšœå†…å­˜å®‰å…¨ï¼Œå› æ­¤ç†è§£ Rust ä¸­æ‰€æœ‰æƒå¦‚ä½•å·¥ä½œæ˜¯ååˆ†é‡è¦çš„ã€‚  
è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®çš„æ•°é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†æ‰€æœ‰æƒï¼Œä½ å°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †äº†ï¼Œä¸è¿‡æ˜ç™½äº†**æ‰€æœ‰æƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†ç®¡ç†å †æ•°æ®**ï¼Œèƒ½å¤Ÿå¸®åŠ©è§£é‡Šä¸ºä»€ä¹ˆæ‰€æœ‰æƒè¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚

#### æ‰€æœ‰æƒè§„åˆ™

1. Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª **æ‰€æœ‰è€…**ï¼ˆ*owner*ï¼‰ã€‚
2. å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
3. å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚

#### å†…å­˜ä¸åˆ†é…

å†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾ï¼š

```rust
fn main() {
    {
        let s = String::from("hello"); // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„
        // ä½¿ç”¨ s
    }                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ
                                       // s ä¸å†æœ‰æ•ˆ
}
```

å½“ `s` ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš [`drop`](https://doc.rust-lang.org/std/ops/trait.Drop.html#tymethod.drop)ï¼Œåœ¨è¿™é‡Œ `String` çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ `}` å¤„è‡ªåŠ¨è°ƒç”¨ `drop`ã€‚

è¿™ä¸ªæ¨¡å¼å¯¹ç¼–å†™ Rust ä»£ç çš„æ–¹å¼æœ‰ç€æ·±è¿œçš„å½±å“ã€‚ç°åœ¨å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä¸è¿‡åœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ä»£ç çš„è¡Œä¸ºå¯èƒ½æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œæ¯”å¦‚å½“æœ‰å¤šä¸ªå˜é‡ä½¿ç”¨åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜æ—¶ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¢ç´¢ä¸€äº›è¿™æ ·çš„åœºæ™¯ã€‚
- **å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨**    
  
  ```rust
  fn main() {
      let s1 = String::from("hello");
      let s2 = s1;
  
      println!("{}, world!", s1);
  
  }
  _______________________________________
  compile error !
  ```
  <img src=".\images\Rust_4-1.png" alt="s1å’Œs2çš„å†…å­˜åˆ†å¸ƒ" style="zoom: 67%;" />
  `s1` `s2`æŒ‡å‘åŒä¸€å—å †å†…å­˜ï¼Œå½“å®ƒä»¬ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå«åš**äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble free)**çš„é”™è¯¯ã€‚ä¸¤æ¬¡é‡Šæ”¾ç›¸åŒå†…å­˜ä¼šå¯¼è‡´å†…å­˜æ±¡æŸ“ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚
  ä¸ºäº†ç¡®ä¿å†…å­˜å®‰å…¨ï¼Œåœ¨ `let s2 = s1;` ä¹‹åï¼ŒRust è®¤ä¸º `s1` ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ Rust ä¸éœ€è¦åœ¨ `s1` ç¦»å¼€ä½œç”¨åŸŸåæ¸…ç†ä»»ä½•ä¸œè¥¿ã€‚è¿™æ ·å°±è§£å†³äº†æˆ‘ä»¬çš„é—®é¢˜ï¼å› ä¸ºåªæœ‰ `s2` æ˜¯æœ‰æ•ˆçš„ï¼Œå½“å…¶ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒå°±é‡Šæ”¾è‡ªå·±çš„å†…å­˜ã€‚

  å¦å¤–ï¼Œè¿™é‡Œè¿˜éšå«äº†ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼š**Rust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€**ã€‚å› æ­¤ï¼Œä»»ä½• **è‡ªåŠ¨** çš„å¤åˆ¶å¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚
  
- **å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆäºŒï¼‰ï¼šå…‹éš†**  

  ```rust
  fn main() {
      let s1 = String::from("hello");
      let s2 = s1.clone();
  
      println!("s1 = {}, s2 = {}", s1, s2);
  }
  ```

  è¿™æ®µä»£ç èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œå †ä¸Šçš„æ•°æ®ç¡®å®è¢«å¤åˆ¶äº†ã€‚å½“å‡ºç° `clone` è°ƒç”¨æ—¶ï¼Œä¼šè¿›è¡Œæ·±æ‹·è´ã€‚

- **åªåœ¨æ ˆä¸Šçš„æ‹·è´**  

  ```rust
  fn main() {
      let x = 5;
      let y = x;
  
      println!("x = {}, y = {}", x, y);
  }
  ```

  è¿™æ®µä»£ç ä¼¼ä¹ä¸æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„å†…å®¹ç›¸çŸ›ç›¾ï¼šæ²¡æœ‰è°ƒç”¨ `clone`ï¼Œä¸è¿‡ `x` ä¾ç„¶æœ‰æ•ˆä¸”æ²¡æœ‰è¢«ç§»åŠ¨åˆ° `y` ä¸­ã€‚

  åŸå› æ˜¯åƒæ•´å‹è¿™æ ·çš„åœ¨ç¼–è¯‘æ—¶å·²çŸ¥å¤§å°çš„ç±»å‹è¢«æ•´ä¸ªå­˜å‚¨åœ¨æ ˆä¸Šï¼Œè¿™é‡Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼Œæ‰€ä»¥è¿™é‡Œè°ƒç”¨ `clone` å¹¶ä¸ä¼šä¸é€šå¸¸çš„æµ…æ‹·è´æœ‰ä»€ä¹ˆä¸åŒã€‚

  ç¬¦åˆè¯¥ç‰¹å¾çš„æ•°æ®ç±»å‹æœ‰ï¼š

  - æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ `u32`ã€‚
  - å¸ƒå°”ç±»å‹ï¼Œ`bool`ï¼Œå®ƒçš„å€¼æ˜¯ `true` å’Œ `false`ã€‚
  - æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ `f64`ã€‚
  - å­—ç¬¦ç±»å‹ï¼Œ`char`ã€‚
  - å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° `Copy` çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ`(i32, i32)` å®ç°äº† `Copy`ï¼Œä½† `(i32, String)` å°±æ²¡æœ‰ã€‚

#### æ‰€æœ‰æƒä¸å‡½æ•°

å°†å€¼ä¼ é€’ç»™å‡½æ•°ä¸ç»™å˜é‡èµ‹å€¼çš„åŸç†ç›¸ä¼¼ã€‚å‘å‡½æ•°ä¼ é€’å€¼å¯èƒ½ä¼šç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·ã€‚ä¸‹é¢çš„æ³¨é‡Šå±•ç¤ºå˜é‡ä½•æ—¶è¿›å…¥å’Œç¦»å¼€ä½œç”¨åŸŸï¼š

```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

    makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                    // ä½† i32 æ˜¯ Copy çš„ï¼Œ
                                    // æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œï¼Œx å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚
  // å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„
```

#### å¼•ç”¨å’Œå€Ÿç”¨

**å¼•ç”¨**ï¼ˆ*reference*ï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚ ä¸æŒ‡é’ˆä¸åŒï¼Œå¼•ç”¨ç¡®ä¿æŒ‡å‘æŸä¸ªç‰¹å®šç±»å‹çš„æœ‰æ•ˆå€¼ã€‚**å¼•ç”¨å…è®¸ä½ ä½¿ç”¨å€¼ä½†ä¸è·å–å…¶æ‰€æœ‰æƒ**ã€‚

```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
}
```

<img src=".\images\Rust_4-2.png" alt="å¼•ç”¨" style="zoom:67%;" />

åŒç†ï¼Œå‡½æ•°ç­¾åä½¿ç”¨ `&` æ¥è¡¨æ˜å‚æ•° `s`çš„ç±»å‹æ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚è®©æˆ‘ä»¬å¢åŠ ä¸€äº›è§£é‡Šæ€§çš„æ³¨é‡Šï¼š

```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize { // s æ˜¯ String çš„å¼•ç”¨
    s.len()
} // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
```

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º **å€Ÿç”¨**ï¼ˆ*borrowing*ï¼‰ã€‚æ­£å¦‚ç°å®ç”Ÿæ´»ä¸­ï¼Œå¦‚æœä¸€ä¸ªäººæ‹¥æœ‰æŸæ ·ä¸œè¥¿ï¼Œä½ å¯ä»¥ä»ä»–é‚£é‡Œå€Ÿæ¥ã€‚å½“ä½ ä½¿ç”¨å®Œæ¯•ï¼Œå¿…é¡»è¿˜å›å»ã€‚æˆ‘ä»¬å¹¶ä¸æ‹¥æœ‰å®ƒï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ä¿®æ”¹å¼•ç”¨çš„å˜é‡ï¼š

```rust
fn main() {
    let s = String::from("hello");
    change(&s);
}

fn change(some_string: &String) {
    some_string.push_str(", world");
}
________________________________________
compile error !
```

#### å¯å˜å¼•ç”¨

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå°è°ƒæ•´å°±èƒ½ä¿®å¤ç¤ºä¾‹ 4-6 ä»£ç ä¸­çš„é”™è¯¯ï¼Œå…è®¸æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œè¿™å°±æ˜¯ **å¯å˜å¼•ç”¨**ï¼ˆ*mutable reference*ï¼‰ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    change(&mut s);
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```

å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è¯¥å˜é‡çš„å¯å˜å¼•ç”¨ï¼Œä½ å°±ä¸èƒ½ä½¿ç”¨è¯¥å˜é‡çš„å¦ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚åŒæ—¶ä½¿ç”¨ä¸¤ä¸ª `s` çš„å¯å˜å¼•ç”¨çš„ä»£ç ä¼šå¤±è´¥ï¼š

```rust
fn main() {
    let mut s = String::from("hello");

    let r1 = &mut s;
    let r2 = &mut s;

    println!("{}, {}", r1, r2); // compile error !
    
    println!("{}", r1); // compile error !
    println!("{}", r2); // å¯ä»¥
}
```

è¿™ä¸€é™åˆ¶ä»¥ä¸€ç§éå¸¸å°å¿ƒè°¨æ…çš„æ–¹å¼å…è®¸å¯å˜æ€§ï¼Œé˜²æ­¢åŒä¸€æ—¶é—´å¯¹åŒä¸€æ•°æ®å­˜åœ¨å¤šä¸ªå¯å˜å¼•ç”¨ã€‚æ–° Rustacean ä»¬ç»å¸¸éš¾ä»¥é€‚åº”è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è¯­è¨€ä¸­å˜é‡ä»»ä½•æ—¶å€™éƒ½æ˜¯å¯å˜çš„ã€‚è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚**æ•°æ®ç«äº‰**ï¼ˆ*data race*ï¼‰ç±»ä¼¼äºç«æ€æ¡ä»¶ï¼Œå®ƒå¯ç”±è¿™ä¸‰ä¸ªè¡Œä¸ºé€ æˆï¼š

- ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ã€‚
- è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ã€‚
- æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚

æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œéš¾ä»¥åœ¨è¿è¡Œæ—¶è¿½è¸ªï¼Œå¹¶ä¸”éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ï¼›Rust é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºå®ƒç”šè‡³ä¸ä¼šç¼–è¯‘å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç ï¼

ä¸€å¦‚æ—¢å¾€ï¼Œå¯ä»¥ä½¿ç”¨å¤§æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ‹¥æœ‰å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåªæ˜¯ä¸èƒ½ **åŒæ—¶** æ‹¥æœ‰ï¼šï¼ˆå†™å†™å†²çªï¼‰

```rust
    let mut s = String::from("hello");

    {
        let r1 = &mut s;
    } // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨

    let r2 = &mut s;
```

æˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨æ‹¥æœ‰ä¸å¯å˜å¼•ç”¨çš„åŒæ—¶æ‹¥æœ‰å¯å˜å¼•ç”¨ã€‚Rust åœ¨åŒæ—¶ä½¿ç”¨å¯å˜ä¸ä¸å¯å˜å¼•ç”¨æ—¶ä¹Ÿé‡‡ç”¨çš„ç±»ä¼¼çš„è§„åˆ™ã€‚è¿™äº›ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼šï¼ˆè¯»å†™å†²çªï¼‰

```rust
    let mut s = String::from("hello");

    let r1 = &s; // æ²¡é—®é¢˜
    let r2 = &s; // æ²¡é—®é¢˜
    let r3 = &mut s; // å¤§é—®é¢˜

    println!("{}, {}, and {}", r1, r2, r3);
____________________________________________________
compile error !
```

#### æ‚¬ç©ºå¼•ç”¨

åœ¨å…·æœ‰æŒ‡é’ˆçš„è¯­è¨€ä¸­ï¼Œå¾ˆå®¹æ˜“é€šè¿‡é‡Šæ”¾å†…å­˜æ—¶ä¿ç•™æŒ‡å‘å®ƒçš„æŒ‡é’ˆè€Œé”™è¯¯åœ°ç”Ÿæˆä¸€ä¸ª **æ‚¬å‚æŒ‡é’ˆ**ï¼ˆ*dangling pointer*ï¼‰ï¼Œæ‰€è°“æ‚¬å‚æŒ‡é’ˆæ˜¯å…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½å·²ç»è¢«åˆ†é…ç»™å…¶å®ƒæŒæœ‰è€…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ Rust ä¸­ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰ç¦»å¼€ä½œç”¨åŸŸã€‚

è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼ŒRust ä¼šé€šè¿‡ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯æ¥é¿å…ï¼š

æ–‡ä»¶åï¼šsrc/main.rs

```rust
fn main() {
    let reference_to_nothing = dangle();
}

fn dangle() -> &String { // dangle è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨

    let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²

    &s // è¿”å›å­—ç¬¦ä¸² s çš„å¼•ç”¨
} // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒï¼Œå…¶å†…å­˜è¢«é‡Šæ”¾ï¼Œæˆä¸ºæ‚¬ç©ºå¼•ç”¨
________________________________________________________
compile error !
```

è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥è¿”å› `String`ï¼š

```rust
fn no_dangle() -> String {
    let s = String::from("hello");

    s
}
```

#### Sliceç±»å‹

*slice* å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚slice æ˜¯ä¸€ç±»å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚

- **å­—ç¬¦ä¸²slice**   
  **å­—ç¬¦ä¸² slice**ï¼ˆ*string slice*ï¼‰æ˜¯ `String` ä¸­ä¸€éƒ¨åˆ†å€¼çš„å¼•ç”¨ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š

  ```rust
      let s = String::from("hello world");
  
      let hello = &s[0..5];
      let world = &s[6..11];
  ```

  å¯¹äº Rust çš„ `..` range è¯­æ³•ï¼Œå¦‚æœæƒ³è¦ä»ç´¢å¼• 0 å¼€å§‹ï¼Œå¯ä»¥ä¸å†™ä¸¤ä¸ªç‚¹å·ä¹‹å‰çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚ä¸‹ä¸¤ä¸ªè¯­å¥æ˜¯ç›¸åŒçš„ï¼š
  
  ```rust
  let s = String::from("hello");
  
  let slice = &s[0..2];
  let slice = &s[..2];
  ```
  
  ä¾æ­¤ç±»æ¨ï¼Œå¦‚æœ slice åŒ…å« `String` çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥èˆå¼ƒå°¾éƒ¨çš„æ•°å­—ã€‚è¿™æ„å‘³ç€å¦‚ä¸‹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼š
  
  ```rust
  let s = String::from("hello");
  
  let len = s.len();
  
  let slice = &s[3..len];
  let slice = &s[3..];
  ```
  
  ä¹Ÿå¯ä»¥åŒæ—¶èˆå¼ƒè¿™ä¸¤ä¸ªå€¼æ¥è·å–æ•´ä¸ªå­—ç¬¦ä¸²çš„ sliceã€‚æ‰€ä»¥å¦‚ä¸‹äº¦æ˜¯ç›¸åŒçš„ï¼š
  
  ```rust
  let s = String::from("hello");
  
  let len = s.len();
  
  let slice = &s[0..len];
  let slice = &s[..];
  ```
- ğŸ§**å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯ slice**
  
  ```rust
  let s = "Hello, world!";
  ```
  
  è¿™é‡Œ s çš„ç±»å‹æ˜¯ &strï¼šå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„ sliceã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼š&str æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ã€‚

- **å…¶ä»–ç±»å‹çš„slice**

  å­—ç¬¦ä¸² sliceï¼Œæ­£å¦‚ä½ æƒ³è±¡çš„é‚£æ ·ï¼Œæ˜¯é’ˆå¯¹å­—ç¬¦ä¸²çš„ã€‚ä¸è¿‡ä¹Ÿæœ‰æ›´é€šç”¨çš„ slice ç±»å‹ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªæ•°ç»„ï¼š

  ```rust
  let a = [1, 2, 3, 4, 5];
  ```

  å°±è·Ÿæˆ‘ä»¬æƒ³è¦è·å–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†é‚£æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæƒ³è¦å¼•ç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š

  ```rust
  let a = [1, 2, 3, 4, 5];
  
  let slice = &a[1..3];
  
  assert_eq!(slice, &[2, 3]);
  ```

  è¿™ä¸ª slice çš„ç±»å‹æ˜¯ `&[i32]`ã€‚å®ƒè·Ÿå­—ç¬¦ä¸² slice çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡å­˜å‚¨ç¬¬ä¸€ä¸ªé›†åˆå…ƒç´ çš„å¼•ç”¨å’Œä¸€ä¸ªé›†åˆæ€»é•¿åº¦ã€‚ä½ å¯ä»¥å¯¹å…¶ä»–æ‰€æœ‰é›†åˆä½¿ç”¨è¿™ç±» sliceã€‚ç¬¬å…«ç« è®²åˆ° vector æ—¶ä¼šè¯¦ç»†è®¨è®ºè¿™äº›é›†åˆã€‚
  
  

### ç»“æ„ä½“

```rust
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
```
é€šè¿‡ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šå…·ä½“å€¼æ¥åˆ›å»ºè¿™ä¸ªç»“æ„ä½“çš„å®ä¾‹ã€‚åˆ›å»ºä¸€ä¸ªå®ä¾‹éœ€è¦ä»¥ç»“æ„ä½“çš„åå­—å¼€å¤´ï¼Œæ¥ç€åœ¨å¤§æ‹¬å·ä¸­ä½¿ç”¨ key: value é”® - å€¼å¯¹çš„å½¢å¼æä¾›å­—æ®µã€‚å®ä¾‹ä¸­å­—æ®µçš„é¡ºåºä¸éœ€è¦å’Œå®ƒä»¬åœ¨ç»“æ„ä½“ä¸­å£°æ˜çš„é¡ºåºä¸€è‡´ã€‚
```rust
fn main() {
    let mut user1 = User {
        active: true,
        username: String::from("someusername123"),
        email: String::from("someone@example.com"),
        sign_in_count: 1,
    };
    
    user1.email = String::from("anotheremail@example.com");
}
```

æ³¨æ„å¯å˜æ€§å¿…é¡»ä½œç”¨åœ¨æ•´ä¸ªå®ä¾‹ï¼›Rust å¹¶ä¸å…è®¸åªå°†æŸä¸ªå­—æ®µæ ‡è®°ä¸ºå¯å˜ã€‚

#### ä½¿ç”¨å­—æ®µåˆå§‹åŒ–ç®€å†™è¯­æ³•

`build_user` å‡½æ•°è·å– email å’Œç”¨æˆ·åå¹¶è¿”å› `User` å®ä¾‹ï¼š

```rust
fn build_user(email: String, username: String) -> User {
    User {
        active: true,
        username: username,
        email: email,
        sign_in_count: 1,
    }
}
```

ä¸ºå‡½æ•°å‚æ•°èµ·ä¸ç»“æ„ä½“å­—æ®µç›¸åŒçš„åå­—æ˜¯å¯ä»¥ç†è§£çš„ï¼Œä½†æ˜¯ä¸å¾—ä¸é‡å¤ `email` å’Œ `username` å­—æ®µåç§°ä¸å˜é‡æœ‰äº›å•°å—¦ã€‚å¦‚æœç»“æ„ä½“æœ‰æ›´å¤šå­—æ®µï¼Œé‡å¤æ¯ä¸ªåç§°å°±æ›´åŠ çƒ¦äººäº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ç®€å†™è¯­æ³•ï¼Œ **å­—æ®µåˆå§‹åŒ–ç®€å†™è¯­æ³•**ï¼š

```rust
fn build_user(email: String, username: String) -> User {
    User {
        active: true,
        username,
        email,
        sign_in_count: 1,
    }
}
```

#### ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ä»å…¶ä»–å®ä¾‹åˆ›å»ºå®ä¾‹

ä½¿ç”¨æ—§å®ä¾‹çš„å¤§éƒ¨åˆ†å€¼ä½†æ”¹å˜å…¶éƒ¨åˆ†å€¼æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“æ„ä½“å®ä¾‹é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™å¯ä»¥é€šè¿‡ **ç»“æ„ä½“æ›´æ–°è¯­æ³•**ï¼ˆ*struct update syntax*ï¼‰å®ç°ã€‚

ä¸‹é¢æ¼”ç¤ºäº†å¦‚ä½•åœ¨ `user2` ä¸­åˆ›å»ºä¸€ä¸ªæ–° `User` å®ä¾‹ã€‚æˆ‘ä»¬ä¸º `email` è®¾ç½®äº†æ–°çš„å€¼ï¼Œå…¶ä»–å€¼åˆ™ä½¿ç”¨äº†å®ä¾‹ 5-2 ä¸­åˆ›å»ºçš„ `user1` ä¸­çš„åŒåå€¼ï¼š

```rust
fn main() {
    // --snip--

    let user2 = User {
        active: user1.active,
        username: user1.username,
        email: String::from("another@example.com"),
        sign_in_count: user1.sign_in_count,
    };
}
```

ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´å°‘çš„ä»£ç æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œå¦‚ç¤ºä¾‹ 5-7 æ‰€ç¤ºã€‚`..` è¯­æ³•æŒ‡å®šäº†å‰©ä½™æœªæ˜¾å¼è®¾ç½®å€¼çš„å­—æ®µåº”æœ‰ä¸ç»™å®šå®ä¾‹å¯¹åº”å­—æ®µç›¸åŒçš„å€¼ã€‚  

```rust
fn main() {
    // --snip--

    let user2 = User {
        email: String::from("another@example.com"),
        ..user1
    };
}
```

ğŸ§æ³¨æ„ï¼Œç»“æ„æ›´æ–°è¯­æ³•å°±åƒå¸¦æœ‰ `=` çš„èµ‹å€¼ï¼Œå› ä¸ºå®ƒç§»åŠ¨äº†æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ€»ä½“ä¸Šè¯´æˆ‘ä»¬åœ¨åˆ›å»º `user2` åä¸èƒ½å°±å†ä½¿ç”¨ `user1` äº†ï¼Œå› ä¸º `user1` çš„ `username` å­—æ®µä¸­çš„ `String` è¢«ç§»åˆ° `user2` ä¸­ã€‚å¦‚æœæˆ‘ä»¬ç»™ `user2` çš„ `email` å’Œ `username` éƒ½èµ‹äºˆæ–°çš„ `String` å€¼ï¼Œä»è€Œåªä½¿ç”¨ `user1` çš„ `active` å’Œ `sign_in_count` å€¼ï¼Œé‚£ä¹ˆ `user1` åœ¨åˆ›å»º `user2` åä»ç„¶æœ‰æ•ˆã€‚

#### å…ƒç»„ç»“æ„ä½“

å¯ä»¥å®šä¹‰ä¸å…ƒç»„ç±»ä¼¼çš„ç»“æ„ä½“ï¼Œç§°ä¸º **å…ƒç»„ç»“æ„ä½“**ï¼ˆ*tuple structs*ï¼‰ã€‚å…ƒç»„ç»“æ„ä½“æœ‰ç€ç»“æ„ä½“åç§°æä¾›çš„å«ä¹‰ï¼Œä½†æ²¡æœ‰å…·ä½“çš„å­—æ®µåï¼Œåªæœ‰å­—æ®µçš„ç±»å‹ã€‚å½“ä½ æƒ³ç»™æ•´ä¸ªå…ƒç»„å–ä¸€ä¸ªåå­—ï¼Œå¹¶ä½¿å…ƒç»„æˆä¸ºä¸å…¶ä»–å…ƒç»„ä¸åŒçš„ç±»å‹æ—¶ï¼Œå…ƒç»„ç»“æ„ä½“æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè¿™æ—¶åƒå¸¸è§„ç»“æ„ä½“é‚£æ ·ä¸ºæ¯ä¸ªå­—æ®µå‘½åå°±æ˜¾å¾—å¤šä½™å’Œå½¢å¼åŒ–äº†ã€‚

è¦å®šä¹‰å…ƒç»„ç»“æ„ä½“ï¼Œä»¥ `struct` å…³é”®å­—å’Œç»“æ„ä½“åå¼€å¤´å¹¶åè·Ÿå…ƒç»„ä¸­çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªåˆ†åˆ«å«åš `Color` å’Œ `Point` å…ƒç»„ç»“æ„ä½“çš„å®šä¹‰å’Œç”¨æ³•ï¼š

```rust
struct Color(i32, i32, i32);
struct Point(i32, i32, i32);

fn main() {
    let black = Color(0, 0, 0);
    let origin = Point(0, 0, 0);
}
```

#### ç±»å•å…ƒç»“æ„ä½“

æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼å®ƒä»¬è¢«ç§°ä¸º **ç±»å•å…ƒç»“æ„ä½“**ï¼ˆ*unit-like structs*ï¼‰ç±»ä¼¼äº `()`ã€‚

```rust
struct AlwaysEqual;

fn main() {
    let subject = AlwaysEqual;
}
```

#### ç»“æ„ä½“æ•°æ®çš„æ‰€æœ‰æƒ

åœ¨ `User` ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ `String` ç±»å‹è€Œä¸æ˜¯ `&str` å­—ç¬¦ä¸² slice ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„è€Œä¸ºä¹‹çš„é€‰æ‹©ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦è¿™ä¸ªç»“æ„ä½“æ‹¥æœ‰å®ƒæ‰€æœ‰çš„æ•°æ®ï¼Œä¸ºæ­¤åªè¦æ•´ä¸ªç»“æ„ä½“æ˜¯æœ‰æ•ˆçš„è¯å…¶æ•°æ®ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚

å¯ä»¥ä½¿ç»“æ„ä½“å­˜å‚¨è¢«å…¶ä»–å¯¹è±¡æ‹¥æœ‰çš„æ•°æ®çš„å¼•ç”¨ï¼Œä¸è¿‡è¿™ä¹ˆåšçš„è¯éœ€è¦ç”¨ä¸Š **ç”Ÿå‘½å‘¨æœŸ**ï¼ˆ*lifetimes*ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç¬¬åç« ä¼šè®¨è®ºçš„ Rust åŠŸèƒ½ã€‚ç”Ÿå‘½å‘¨æœŸç¡®ä¿ç»“æ„ä½“å¼•ç”¨çš„æ•°æ®æœ‰æ•ˆæ€§è·Ÿç»“æ„ä½“æœ¬èº«ä¿æŒä¸€è‡´ã€‚å¦‚æœä½ å°è¯•åœ¨ç»“æ„ä½“ä¸­å­˜å‚¨ä¸€ä¸ªå¼•ç”¨è€Œä¸æŒ‡å®šç”Ÿå‘½å‘¨æœŸå°†æ˜¯æ— æ•ˆçš„ï¼Œæ¯”å¦‚è¿™æ ·ï¼š

```rust
struct User {
    active: bool,
    username: &str,
    email: &str,
    sign_in_count: u64,
}

fn main() {
    let user1 = User {
        active: true,
        username: "someusername123",
        email: "someone@example.com",
        sign_in_count: 1,
    };
}
```

ç¼–è¯‘å™¨ä¼šæŠ±æ€¨å®ƒéœ€è¦ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ç¬¦ï¼š

```console
$ cargo run
   Compiling structs v0.1.0 (file:///projects/structs)
error[E0106]: missing lifetime specifier
 --> src/main.rs:3:15
  |
3 |     username: &str,
  |               ^ expected named lifetime parameter
  |
help: consider introducing a named lifetime parameter
  |
1 ~ struct User<'a> {
2 |     active: bool,
3 ~     username: &'a str,
  |

error[E0106]: missing lifetime specifier
 --> src/main.rs:4:12
  |
4 |     email: &str,
  |            ^ expected named lifetime parameter
  |
help: consider introducing a named lifetime parameter
  |
1 ~ struct User<'a> {
2 |     active: bool,
3 |     username: &str,
4 ~     email: &'a str,
  |

For more information about this error, try `rustc --explain E0106`.
error: could not compile `structs` due to 2 previous errors
```

ç¬¬åç« ä¼šè®²åˆ°å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ä»¥ä¾¿åœ¨ç»“æ„ä½“ä¸­å­˜å‚¨å¼•ç”¨ï¼Œä¸è¿‡ç°åœ¨ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åƒ `String` è¿™ç±»æ‹¥æœ‰æ‰€æœ‰æƒçš„ç±»å‹æ¥æ›¿ä»£ `&str` è¿™æ ·çš„å¼•ç”¨ä»¥ä¿®æ­£è¿™ä¸ªé”™è¯¯ã€‚

#### é€šè¿‡æ´¾ç”Ÿ trait å¢åŠ å®ç”¨åŠŸèƒ½ğŸ§

åœ¨è°ƒè¯•ç¨‹åºæ—¶æ‰“å°å‡º `Rectangle` å®ä¾‹æ¥æŸ¥çœ‹å…¶æ‰€æœ‰å­—æ®µçš„å€¼éå¸¸æœ‰ç”¨ã€‚ç¤ºä¾‹åƒå‰é¢ç« èŠ‚é‚£æ ·å°è¯•ä½¿ç”¨ [`println!` å®](https://doc.rust-lang.org/std/macro.println.html)ã€‚ä½†è¿™å¹¶ä¸è¡Œã€‚

```rust
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {}", rect1);
}
```

å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªä»£ç æ—¶ï¼Œä¼šå‡ºç°å¸¦æœ‰å¦‚ä¸‹æ ¸å¿ƒä¿¡æ¯çš„é”™è¯¯ï¼š

```text
error[E0277]: `Rectangle` doesn't implement `std::fmt::Display`
```

`println!` å®èƒ½å¤„ç†å¾ˆå¤šç±»å‹çš„æ ¼å¼ï¼Œ**ä½†`{}` é»˜è®¤å‘Šè¯‰ `println!` ä½¿ç”¨è¢«ç§°ä¸º `Display` çš„æ ¼å¼**ï¼Œç»“æ„ä½“å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªé»˜è®¤`Display` å®ç°æ¥ä½¿ç”¨ `println!` ä¸ `{}` å ä½ç¬¦ã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç»§ç»­é˜…è¯»é”™è¯¯ï¼Œå°†ä¼šå‘ç°è¿™ä¸ªæœ‰å¸®åŠ©çš„ä¿¡æ¯ï¼š

```text
= help: the trait `std::fmt::Display` is not implemented for `Rectangle`
= note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
```

**`{:?}` æŒ‡ç¤ºç¬¦å‘Šè¯‰ `println!` æˆ‘ä»¬æƒ³è¦ä½¿ç”¨å«åš `Debug` çš„è¾“å‡ºæ ¼å¼**ã€‚`Debug` æ˜¯ä¸€ä¸ª traitï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥ä¸€ç§å¯¹å¼€å‘è€…æœ‰å¸®åŠ©çš„æ–¹å¼æ‰“å°ç»“æ„ä½“ï¼Œä»¥ä¾¿å½“æˆ‘ä»¬è°ƒè¯•ä»£ç æ—¶èƒ½çœ‹åˆ°å®ƒçš„å€¼ã€‚

è¿™æ ·è°ƒæ•´åå†æ¬¡è¿è¡Œç¨‹åºã€‚è§é¬¼äº†ï¼ä»ç„¶èƒ½çœ‹åˆ°ä¸€ä¸ªé”™è¯¯ï¼š

```text
error[E0277]: `Rectangle` doesn't implement `Debug`
```

ä¸è¿‡ç¼–è¯‘å™¨åˆä¸€æ¬¡ç»™å‡ºäº†ä¸€ä¸ªæœ‰å¸®åŠ©çš„ä¿¡æ¯ï¼š

```text
   = help: the trait `Debug` is not implemented for `Rectangle`
   = note: add `#[derive(Debug)]` to `Rectangle` or manually `impl Debug for Rectangle`
```

Rustç¡®å®åŒ…å«äº†æ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯çš„åŠŸèƒ½ï¼Œä¸è¿‡æˆ‘ä»¬å¿…é¡»ä¸ºç»“æ„ä½“æ˜¾å¼é€‰æ‹©è¿™ä¸ªåŠŸèƒ½ã€‚**ä¸ºæ­¤ï¼Œåœ¨ç»“æ„ä½“å®šä¹‰ä¹‹å‰åŠ ä¸Šå¤–éƒ¨å±æ€§ `#[derive(Debug)]`**ï¼Œ

æ–‡ä»¶åï¼šsrc/main.rs

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!("rect1 is {:?}", rect1);
}
```

ç°åœ¨æˆ‘ä»¬å†è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå°±ä¸ä¼šæœ‰ä»»ä½•é”™è¯¯ï¼Œå¹¶ä¼šå‡ºç°å¦‚ä¸‹è¾“å‡ºï¼š

```console
rect1 is Rectangle { width: 30, height: 50 }
```

å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´å¤§çš„ç»“æ„ä½“æ—¶ï¼Œèƒ½æœ‰æ›´æ˜“è¯»ä¸€ç‚¹çš„è¾“å‡ºå°±å¥½äº†ï¼Œ**ä¸ºæ­¤å¯ä»¥ä½¿ç”¨ `{:#?}` æ›¿æ¢ `println!` å­—ç¬¦ä¸²ä¸­çš„ `{:?}`å¢åŠ å¯è¯»æ€§ã€‚**åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨ `{:#?}` é£æ ¼å°†ä¼šè¾“å‡ºå¦‚ä¸‹ï¼š

```console
rect1 is Rectangle {
    width: 30,
    height: 50,
}
```

å¦ä¸€ç§ä½¿ç”¨ `Debug` æ ¼å¼æ‰“å°æ•°å€¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨ [`dbg!` å®](https://doc.rust-lang.org/std/macro.dbg.html)ã€‚`dbg!` å®æ¥æ”¶ä¸€ä¸ªè¡¨è¾¾å¼çš„æ‰€æœ‰æƒï¼ˆä¸ `println!` å®ç›¸åï¼Œåè€…æ¥æ”¶çš„æ˜¯å¼•ç”¨ï¼‰ï¼Œæ‰“å°å‡ºä»£ç ä¸­è°ƒç”¨ dbg! å®æ—¶æ‰€åœ¨çš„æ–‡ä»¶å’Œè¡Œå·ï¼Œä»¥åŠè¯¥è¡¨è¾¾å¼çš„ç»“æœå€¼ï¼Œ**å¹¶è¿”å›è¯¥å€¼çš„æ‰€æœ‰æƒ**ã€‚

> æ³¨æ„ï¼šè°ƒç”¨ `dbg!` å®ä¼šæ‰“å°åˆ°æ ‡å‡†é”™è¯¯æ§åˆ¶å°æµï¼ˆ`stderr`ï¼‰ï¼Œä¸ `println!` ä¸åŒï¼Œåè€…ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæ§åˆ¶å°æµï¼ˆ`stdout`ï¼‰ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯¹åˆ†é…ç»™ `width` å­—æ®µçš„å€¼ä»¥åŠ `rect1` ä¸­æ•´ä¸ªç»“æ„çš„å€¼æ„Ÿå…´è¶£ã€‚

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    let scale = 2;
    let rect1 = Rectangle {
        width: dbg!(30 * scale),
        height: 50,
    };

    dbg!(&rect1);
}
```

æˆ‘ä»¬å¯ä»¥æŠŠ `dbg!` æ”¾åœ¨è¡¨è¾¾å¼ `30 * scale` å‘¨å›´ï¼Œå› ä¸º `dbg!` è¿”å›è¡¨è¾¾å¼çš„å€¼çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ `width` å­—æ®µå°†è·å¾—ç›¸åŒçš„å€¼ï¼Œå°±åƒæˆ‘ä»¬åœ¨é‚£é‡Œæ²¡æœ‰ `dbg!` è°ƒç”¨ä¸€æ ·ã€‚æˆ‘ä»¬ä¸å¸Œæœ› `dbg!` æ‹¥æœ‰ `rect1` çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ `dbg!` æ—¶ä¼ é€’ä¸€ä¸ªå¼•ç”¨ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªä¾‹å­çš„è¾“å‡ºç»“æœï¼š

```console
[src/main.rs:10] 30 * scale = 60
[src/main.rs:14] &rect1 = Rectangle {
    width: 60,
    height: 50,
}
```

#### æ–¹æ³•

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.height
    }
    
    fn can_hold(&self, other: &Rectangle) -> bool {
        self.width > other.width && self.height > other.height
    }
}

fn main() {
    let rect1 = Rectangle {
        width: 30,
        height: 50,
    };

    println!(
        "The area of the rectangle is {} square pixels.",
        rect1.area()
    );
}
```

ä¸ºäº†ä½¿å‡½æ•°å®šä¹‰äº `Rectangle` çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹äº†ä¸€ä¸ª `impl` å—ï¼Œè¿™ä¸ª `impl` å—ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½å°†ä¸ `Rectangle` ç±»å‹ç›¸å…³è”ã€‚æ¥ç€å°† `area` å‡½æ•°ç§»åŠ¨åˆ° `impl` å¤§æ‹¬å·ä¸­ï¼Œå¹¶å°†ç­¾åä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œå‡½æ•°ä½“ä¸­å…¶ä»–åœ°æ–¹çš„å¯¹åº”å‚æ•°æ”¹æˆ `self`ã€‚

åœ¨ `area` çš„ç­¾åä¸­ï¼Œä½¿ç”¨ `&self` æ¥æ›¿ä»£ `rectangle: &Rectangle`ï¼Œ`&self` å®é™…ä¸Šæ˜¯ `self: &Self` çš„ç¼©å†™ã€‚åœ¨ä¸€ä¸ª `impl` å—ä¸­ï¼Œ`Self` ç±»å‹æ˜¯ `impl` å—çš„ç±»å‹çš„åˆ«åã€‚æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æœ‰ä¸€ä¸ªåä¸º `self` çš„`Self` ç±»å‹çš„å‚æ•°ï¼Œæ‰€ä»¥ Rust è®©ä½ åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®ä¸Šåªç”¨ `self` è¿™ä¸ªåå­—æ¥ç¼©å†™ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨ `self` å‰é¢ä½¿ç”¨ `&` æ¥è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å€Ÿç”¨äº† `Self` å®ä¾‹ã€‚æ–¹æ³•å¯ä»¥é€‰æ‹©è·å¾— `self` çš„æ‰€æœ‰æƒï¼Œæˆ–è€…åƒæˆ‘ä»¬è¿™é‡Œä¸€æ ·ä¸å¯å˜åœ°å€Ÿç”¨ `self`ï¼Œæˆ–è€…å¯å˜åœ°å€Ÿç”¨ `self`ï¼Œå°±è·Ÿå…¶ä»–å‚æ•°ä¸€æ ·ã€‚

#### è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨ğŸ§

åœ¨ C/C++ è¯­è¨€ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ï¼š`.` ç›´æ¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè€Œ `->` åœ¨ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè¿™æ—¶éœ€è¦å…ˆè§£å¼•ç”¨ï¼ˆdereferenceï¼‰æŒ‡é’ˆã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ `object` æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆ `object->something()` å°±åƒ `(*object).something()` ä¸€æ ·ã€‚

Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ `->` ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« **è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨**ï¼ˆ*automatic referencing and dereferencing*ï¼‰çš„åŠŸèƒ½ã€‚æ–¹æ³•è°ƒç”¨æ˜¯ Rust ä¸­å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹ã€‚

å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå½“ä½¿ç”¨ `object.something()` è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸º `object` æ·»åŠ  `&`ã€`&mut` æˆ– `*` ä»¥ä¾¿ä½¿ `object` ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ä»£ç æ˜¯ç­‰ä»·çš„ï¼š

```rust
p1.distance(&p2);
(&p1).distance(&p2);
```

ç¬¬ä¸€è¡Œçœ‹èµ·æ¥ç®€æ´çš„å¤šã€‚è¿™ç§è‡ªåŠ¨å¼•ç”¨çš„è¡Œä¸ºä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºæ–¹æ³•æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ¥æ”¶è€…â€”â€”â€”â€” `self` çš„ç±»å‹ã€‚åœ¨ç»™å‡ºæ¥æ”¶è€…å’Œæ–¹æ³•åçš„å‰æä¸‹ï¼ŒRust å¯ä»¥æ˜ç¡®åœ°è®¡ç®—å‡ºæ–¹æ³•æ˜¯ä»…ä»…è¯»å–ï¼ˆ`&self`ï¼‰ï¼Œåšå‡ºä¿®æ”¹ï¼ˆ`&mut self`ï¼‰æˆ–è€…æ˜¯è·å–æ‰€æœ‰æƒï¼ˆ`self`ï¼‰ã€‚äº‹å®ä¸Šï¼ŒRust å¯¹æ–¹æ³•æ¥æ”¶è€…çš„éšå¼å€Ÿç”¨è®©æ‰€æœ‰æƒåœ¨å®è·µä¸­æ›´å‹å¥½ã€‚

#### æ„é€ å‡½æ•°

æ‰€æœ‰åœ¨ `impl` å—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸º **å…³è”å‡½æ•°**ï¼ˆ*associated functions*ï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä¸ `impl` åé¢å‘½åçš„ç±»å‹ç›¸å…³ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸ä»¥ `self` ä¸ºç¬¬ä¸€å‚æ•°çš„å…³è”å‡½æ•°ï¼ˆå› æ­¤ä¸æ˜¯æ–¹æ³•ï¼‰ï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸ä½œç”¨äºä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹ã€‚æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼šåœ¨ `String` ç±»å‹ä¸Šå®šä¹‰çš„ `String::from` å‡½æ•°ã€‚

ä¸æ˜¯æ–¹æ³•çš„å…³è”å‡½æ•°ç»å¸¸è¢«ç”¨ä½œè¿”å›ä¸€ä¸ªç»“æ„ä½“æ–°å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„åç§°é€šå¸¸ä¸º `new` ï¼Œä½† `new` å¹¶ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªå«åš `square` å…³è”å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç»´åº¦å‚æ•°å¹¶ä¸”åŒæ—¶ä½œä¸ºå®½å’Œé«˜ï¼Œè¿™æ ·å¯ä»¥æ›´è½»æ¾çš„åˆ›å»ºä¸€ä¸ªæ­£æ–¹å½¢ `Rectangle` è€Œä¸å¿…æŒ‡å®šä¸¤æ¬¡åŒæ ·çš„å€¼ï¼š

æ–‡ä»¶åï¼šsrc/main.rs

```rust
impl Rectangle {
    fn square(size: u32) -> Self {
        Self {
            width: size,
            height: size,
        }
    }
}
```

å…³é”®å­— `Self` åœ¨å‡½æ•°çš„è¿”å›ç±»å‹ä¸­ä»£æŒ‡åœ¨ `impl` å…³é”®å­—åå‡ºç°çš„ç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯ `Rectangle`

ä½¿ç”¨ç»“æ„ä½“åå’Œ `::` è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªå…³è”å‡½æ•°ï¼šæ¯”å¦‚ `let sq = Rectangle::square(3);`ã€‚è¿™ä¸ªå‡½æ•°ä½äºç»“æ„ä½“çš„å‘½åç©ºé—´ä¸­ï¼š`::` è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´ã€‚
